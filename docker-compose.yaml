services:
    app:
        build:
            context: .
            target: fpm-${DOCKER_ENV:-dev}
        environment:
            PHP_IDE_CONFIG: serverName=localhost
            XDEBUG_MODE: "${XDEBUG_MODE:-off}"
            APP_ENV: "${APP_ENV:-dev}"
            APP_DEBUG: "${APP_DEBUG:-1}"
        volumes:
            - ./:/usr/app/:cached
            - /usr/app/node_modules/
        extra_hosts:
            - host.docker.internal:host-gateway
    nginx:
        build:
            context: .
            target: nginx-${DOCKER_ENV:-dev}
        ports:
            - 8080:80
            - 8443:443
        volumes:
            - ./public:/usr/app/public:ro,cached
    database:
        image: postgres:14.7-alpine
        environment:
            POSTGRES_DB: symfony
            POSTGRES_USER: symfony
            POSTGRES_PASSWORD: symfony
        ports:
            - 8432:5432
    mailer:
        image: schickling/mailcatcher
        ports:
            - 8025:1080
